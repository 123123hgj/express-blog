{%extends 'layout.html'%}

{% block head %}
<script src="/node_modules/bootstrap/dist/js/bootstrap.min.js"></script>
<link rel="stylesheet" href="/node_modules/bootstrap/dist/css/bootstrap.min.css">
{% endblock %}

{%block content%}
<div class="listBox">
    <h1>{{blog.title}}</h1>
    <p class="colDefault">
        作者：<span class="colInfo">{{blog.author.username}}</span> -
        时间：<span class="colInfo">{{blog.add_time|date('Y-m-d H:i:s', -8*60)}}</span> -
        阅读：<span class="colInfo">{{ blog.view_count }}</span> -
        评论：<span class="colInfo">88</span>
    </p>

    <input type="hidden" id="content" value="{{ blog.content }}">
    <article>
        {% include '../admin/editor.html' %}
    </article>

    <script>
        const content = $('#content').val()
        $('#toolbar').remove()
        editor.setContents(JSON.parse(content))
        editor.enable(false);  
    </script>

</div>

<div class="listBox message">
    <h3 class="textLeft"><strong>评论</strong> <span class="em">一共有 <em id="messageCount">0</em> 条评论</span></h3>

    {% if user %}
    <p id="author" class="textLeft">{{ user.username }}</p>
    <div class="textLeft clear">
        <form method="post" action="/comment">
            <input type="hidden" id="bid" name="bid" value="{{ blog.id }}">
            <textarea id="messageContent" name="content" rows="10"></textarea>
            <button id="messageBtn" class="btn btn-info submit">提交</button>
        </form>


    </div>
    {%else%}
    <p class="bgDanger" style="line-height: 30px;">你还没有登录，请先登录！</p>
    {%endif%}


    <div class="comments" style="text-align: left">
        <div class="items">
                {% for comment in comments %}
                <div class="panel panel-danger comment">
                    <div class="panel-body">
                        {{ comment.author.username }}评论于{{ comment.add_time|date('Y-m-d H:i:s', -8*60) }}
                    </div>
                    <div class="panel-footer">{{ comment.content }}</div>
                </div>
                {% endfor %}
        </div>
        <div class="alert alert-info">
            <p id="more" style="text-align: center;cursor:pointer;">加载更多</p>
        </div>
    </div>

</div>

<script src="/public/js/comment.js"></script>
{%endblock%}